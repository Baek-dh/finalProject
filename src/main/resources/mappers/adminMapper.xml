<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="adminMapper">

	<!-- 회원 조회용 resultMap -->
	<resultMap type="User" id="user_rm">
		<id property="userNo" column="USER_NO"/>
		<result property="userEmail" column="USER_EMAIL"/>
		<result property="userPW" column="USER_PW"/>
		<result property="userName" column="USER_NAME"/>
		<result property="userTel" column="USER_PHONE"/>
		<result property="adminFlag" column="ADMIN_FL"/>
		<result property="userAddress" column="USER_ADDRESS"/>
		<result property="registDate" column="REGIST_DT"/>
		<result property="secessionDate" column="SECESSION_DT"/>
		<result property="profileImage" column="USER_PROFILE"/>
	</resultMap>
	
	<!-- 문의 조회용 resultMap -->
	<resultMap type="Question" id="inquiry_rm">
		<id property="questionNo" column="Q_NO"/>
		<result property="questionTitle" column="Q_TITLE"/>
		<result property="createDate" column="Q_DATE"/>
		<result property="userNo" column="USER_NO"/>
		<result property="userName" column="USER_NAME"/>
		<result property="questionAnswer" column="Q_ANSWER"/>
	</resultMap>
	
	<!-- 신고 조회용 resultMap -->
	<resultMap type="ReportML" id="reportML_rm">
		<id property="reportNo" column="Q_NO"/>
		<result property="reportReason" column="REPORT_REASON"/>
		<result property="reportFlag" column="REPORT_FL"/>
		<result property="reportDate" column="REPORT_DATE"/>
		<result property="moveLineNo" column="ML_NO"/>
		<result property="moveLineTitle" column="ML_TITLE"/>
		<result property="userName" column="USER_NAME"/>
	</resultMap>
	
	



	<!-- 공지 삽입 -->
	<insert id="insertNotice" parameterType="Noticedetail" useGeneratedKeys="true">
		<selectKey keyProperty="noticeNo" resultType="_int" order="BEFORE">
			SELECT SEQ_MB_NO.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO MANAGER_BOARD VALUES(
			#{noticeNo}, #{noticeTitle}, #{noticeContent}, SYSDATE, NULL, #{noticeType}, #{userNo}
		)
	</insert>
	
	<!-- 공지 이미지 삽입 -->
	<insert id="insertNoticeImageList" parameterType="list">
		INSERT INTO MANAGER_BOARD_IMG 
		SELECT SEQ_MB_IMG_NO.NEXTVAL MB_IMG_NO,  A.* FROM(

			<foreach collection="list"  item="img" separator="UNION ALL" >
			    SELECT  #{img.imageReName}     MB_IMG_RENAME, 
			        	#{img.imageLevel}      MB_IMG_LEVEL, 
			        	#{img.noticeNo}        NOTICE_NO
			    FROM DUAL
			</foreach>
		) A   
	</insert>
	
	
	
	
	
	
	<!-- 회원 전체 수 조회 -->
	<select id="getUserListCount" resultType="_int">
		SELECT COUNT(*) FROM USER_TB
		WHERE ADMIN_FL = 'N'
	</select>
	
	<!-- 회원 목록 조회 -->
	<select id="selectUserList" resultMap="user_rm">
		SELECT USER_NO, USER_EMAIL, USER_NAME, USER_PHONE, USER_ADDRESS, 
			TO_CHAR(REGIST_DT, 'YYYY-MM-DD') AS REGIST_DT, TO_CHAR(SECESSION_DT, 'YYYY-MM-DD') AS SECESSION_DT, USER_PROFILE
		FROM USER_TB
		WHERE ADMIN_FL = 'N'
		ORDER BY USER_NO
	</select>
	
	
	
	<!-- 문의 전체 수 조회 -->
	<select id="getIquiryListCount" resultType="_int">
		SELECT COUNT(*) FROM QUESTION
	</select>
	
	
	<!-- 문의 목록 조회 -->
	<select id="selectInquiryList" resultMap="inquiry_rm">
		SELECT Q_NO, Q_TITLE, Q_CONTENT, Q_ANSWER, TO_CHAR(Q_DATE, 'YYYY-MM-DD') Q_DATE, USER_NO, USER_NAME, MANAGER_NO, USER_NAME 
		FROM QUESTION
		JOIN USER_TB USING(USER_NO)
		ORDER BY Q_DATE DESC
	</select>
	
	
	<!-- 코스신고 전체 수 조회 -->
	<select id="getReportListCount" resultType="_int">
		SELECT COUNT(*) FROM REPORT_ML
	</select>
	
	
	<!-- 코스신고 목록 조회 -->
	<select id="selectReportList" resultMap="reportML_rm">
		SELECT REPORT_NO, REPORT_REASON, REPORT_FL, REPORT_DATE, ML_NO, ML_TITLE, USER_NAME
		FROM REPORT_ML
		JOIN USER_TB USING(USER_NO)
		JOIN MOVELINE_BOARD USING(ML_NO)
		ORDER BY REPORT_DATE DESC
	</select>
</mapper>
