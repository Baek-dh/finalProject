<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="landMarkMapper">

	<!-- 지역 조회용 resultMap 
	<resultMap type="Locations" id="Locations_rm">
		<id property="locationNum" column="LOCATION_TYPE" />
		<result property="locationName" column="LOCATION_NAME"/>
	</resultMap>
	-->
	<!-- 랜드마크 목록 조회용 resultMap -->
	<resultMap type="landMark" id="landMark_rm">
		<id property="landMarkNo" column="LM_NO" />
		<result property="landMarkName" column="LM_NAME"/>
		<result property="landMarkContent" column="LM_CONTENT"/>
		<result property="thumbnail" column="THUMBNAIL"/>
	</resultMap>
	
	<!-- 랜드마크 상세 조회용 resultMap -->
	<resultMap type="detail" id="detail_rm">
		<id property="landMarkNo" column="LM_NO" />
		<result property="landMarkName" column="LM_NAME" />
		<result property="landMarkContent" column="LM_CONTENT" />
		<result property="landMarkAddress" column="LM_ADDRESS" />
		<result property="landMarkCreate" column="LM_CREATE_DT" />
		<result property="userName" column="USER_NAME" />
		<collection property="imageList" column="LM_NO" 
			javaType="java.util.ArrayList" ofType="landMarkImage" select="selectImageList"/>
	</resultMap>
	
	<!-- 이미지 정보 조회 resultMap -->
	<resultMap type="landMarkImage" id="landmarkImage_rm">
		<id property="landMarkImageNo" column="LN_IMG_NO" />
		<result property="landMarkRename" column="LM_IMG_RENAME" />
		<result property="landMarkImageLV" column="LM_IMG_LEVEL" />
		<result property="landMarkNo" column="LM_NO" />
	</resultMap> 
	
	
	<!-- ==================================================================================================================== -->
	
	<!-- 지역 번호, 지역명 조회 
	<select id="selectBoardType" resultMap="Location_rm">
		SELECT * FROM LOCATIONS
		ORDER BY LOCATION_TYPE
	</select>-->
	
	<!-- 랜드마크 메인 슬라이드 이미지 조회 -->
	<select id="selectLandMarkIMG" resultMap="landmarkImage_rm">
		SELECT LM_NO, COUNT(USER_NO) AS USER_CT,
    	(SELECT LM_IMG_RENAME FROM LAND_IMG
		WHERE BOOKMARK_LM.LM_NO = LAND_IMG.LM_NO
		AND LM_IMG_LEVEL = 0) THUMBNAIL
    	FROM BOOKMARK_LM
    	GROUP BY LM_NO
    	ORDER BY USER_CT DESC
	</select>
	
	<!-- 랜드마크 전체 수 조회 
	<select id="getListAllCount">
		SELECT COUNT(*) AS LM_COUNT FROM LANDMARK
		WHERE LM_FL = 'N'
	</select>
	-->
	
	<!-- 랜드마크 전체 목록 조회 
	<select id="selectAllLandMarkList" resultMap="landMark_rm">
	SELECT LM_NO, LM_NAME, LM_CONTENT,
	(SELECT LM_IMG_RENAME FROM LAND_IMG
	WHERE LANDMARK.LM_NO = LAND_IMG.LM_NO
	AND LM_IMG_LEVEL = 0) THUMBNAIL
	FROM LANDMARK
	JOIN LOCATIONS USING(LOCATION_TYPE)
	WHERE LM_FL = 'N'
	ORDER BY LM_NO DESC
	</select>
	-->
	
	<!-- 특정 지역의 랜드마크 수 조회 -->
	<select id="getListCount">
		SELECT COUNT(*) FROM LANDMARK
		WHERE LOCATION_TYPE = ${locationNum}
		AND LM_FL = 'N'
	</select>
	

	<!-- 특정 지역의 랜드마크 목록 조회 -->
	<select id="selectLandMarkList" resultMap="landMark_rm">
	SELECT LM_NO, LM_NAME, LM_CONTENT,
	(SELECT LM_IMG_RENAME FROM LAND_IMG
	WHERE LANDMARK.LM_NO = LAND_IMG.LM_NO
	AND LM_IMG_LEVEL = 0) THUMBNAIL
	FROM LANDMARK
	JOIN LOCATIONS USING(LOCATION_TYPE)
	WHERE LM_FL = 'N'
	AND LOCATION_TYPE = ${locationNum}
	ORDER BY LM_NO DESC
	</select>
	
	<!-- 특정 게시글 이미지 목록 조회 -->
	<select id="selectImageList" resultMap="landmarkImage_rm">
	SELECT * FROM LAND_IMG
    WHERE LM_NO = #{landMakrNo}
    ORDER BY LM_IMG_LEVEL;
    </select>
    
	<!-- 랜드마크 상세 조회 -->
	<select id="selectLandMarkDetail" resultMap="detail_rm">
	 SELECT LM_NO, LM_NAME, LM_CONTENT,
     TO_CHAR(LM_CREATE_DT, 'YYYY"년" MM"월" DD"일" HH24:MI:SS') LM_CREATE_DT,
     USER_NAME, USER_NO
     LM_NAME
     FROM LANDMARK
     JOIN USER_TB USING(USER_NO)
     WHERE LM_NO = 1
     AND LM_FL = 'N'
     </select>
	
</mapper>